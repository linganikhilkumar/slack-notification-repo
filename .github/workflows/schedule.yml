name: CheckPendingWorkflows
on:
  schedule:
    - cron: "*/5 5 * * *"
  workflow_dispatch:
    inputs:
      environment:
        default: 'dev'
      version:
        default: 'latest'
jobs:
  stale:
    runs-on: ubuntu-latest
    steps:   
    - name: Get previous build status
      shell: bash
      id: last_status
      run: |
        last_status=$(curl --silent --header 'authorization: Bearer ${{ env.github_token }}' \
                                    --header 'content-type: application/json' \
        "${{ github.api_url }}/repos/${{ github.repository }}/actions/workflows/${{ env.WORKFLOW_ID }}/runs?per_page=1&status=completed&branch=${{ env.BRANCH_NAME }}" \
        | jq -r .workflow_runs[0].status)
        echo "::set-output name=last_status::$last_status"
        echo "Status of the previous build: $last_status"
